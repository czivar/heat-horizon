<a href="#" onClick="javascript:save_template();">Save Template</a>
    <label>Template Name</label>
    <input type="text" name="name">
    <label>Template Description</label>
    <input type="text" name="description">
<a href="#" onClick="javascript:add_resource();">Add Resource</a>
<div id="designer" class="row-fluid" style="position:relative;height:100em;">
  <div id="parameters" class="parameter" style="top:0em;">
    Parameters:
    <a href="#" onClick="javascript:add_parameter();">Add Parameter</a>
  </div> 
</div>
<script type="text/javascript">
  var r_ct = 0;
  var p_ct = 0;

  var exampleColor = "#00f";
  var dropOptions = {
        tolerance:'touch',
        hoverClass:'dropHover',
        activeClass:'dragActive'
      };
  var connectorStyle = {
        gradient:{stops:[[0, exampleColor], [0.5, "#09098e"], [1, exampleColor]]},
        lineWidth:3,
        strokeStyle:exampleColor,
        //dashstyle:"2 2"
      };
  var paintStyle = { width:25, height:21, fillStyle:exampleColor };
  var resourceEndpoint = {
      //endpoint:"Rectangle",
      paintStyle: paintStyle,
      isSource:true,
      reattach:true,
      //scope:"blue rectangle",
      connectorStyle: connectorStyle,
      //beforeDrop:function(params) { 
      //    return confirm("Connect " + params.sourceId + " to " + params.targetId + "?"); 
      //},              
      dropOptions: dropOptions,
      maxConnections: -1
  };
  var parameterEndpoint = {
      //endpoint:"Rectangle",
      paintStyle: paintStyle,
      reattach:true,
      //scope:"blue rectangle",
      connectorStyle: connectorStyle,
      isTarget:true,
      //beforeDrop:function(params) { 
      //    return confirm("Connect " + params.sourceId + " to " + params.targetId + "?"); 
      //},              
      dropOptions: dropOptions,
      maxConnections: -1
  };

  var anchors = [[1, 0.2, 1, 0], [0.8, 1, 0, 1], [0, 0.8, -1, 0], [0.2, 0, 0, -1] ],
      maxConnectionsCallback = function(info) {
         alert("Cannot drop connection " + info.connection.id + " : maxConnections has been reached on Endpoint " + info.endpoint.id);
      };

  //jsPlumb.ready(function() {
  //});

  function add_resource() {
    var r = 'resource'.concat(r_ct++); 
    var d = $('<div>'.concat(r).concat('</div>'));
    d.attr('id', r);
    d.attr('class', 'component window');
    d.appendTo('#designer');
    var e1 = jsPlumb.addEndpoint(d, { anchor:anchors }, resourceEndpoint);
    e1.bind("maxConnections", maxConnectionsCallback);
    jsPlumb.draggable(d, { containment:"parent" });
  };

  function add_parameter() {
    var p = 'parameter'.concat(p_ct++); 
    var d = $('<div>'.concat(p).concat('</div>'));
    d.attr('id', p);
    d.attr('class', 'parameter');
    d.css('top', String(3*p_ct).concat('em'));
    d.appendTo('#designer');
    jsPlumb.addEndpoint(d, { anchor:[0, 0.5, -1, 0, -10, -2] }, parameterEndpoint); //{
        //isTarget:true,
        //reattach:true,
        //dropOptions: exampleDropOptions, });
  };

  function save_template() {
    //alert($('input[name=csrfmiddlewaretoken]').attr('value'));
    $.post('{% url horizon:thermal:designer:index %}',
            { template: $('#designer').html(),
              csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').attr('value'),
              name: $('input[name=name]').val(),
              description: $('input[name=name]').val() } );
  };

  function blah() {
    jsPlumb.connect({ source:"container0", target:"container1" });
  };

</script>
